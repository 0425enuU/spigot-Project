From 6343d48ad9e86d2f069242a8a96ee4fcf988fc3d Mon Sep 17 00:00:00 2001
From: md_5 <md_5@live.com.au>
Date: Sat, 16 Feb 2013 17:56:26 +1100
Subject: [PATCH] Infrequently send tab list updates.

---
 src/main/java/net/minecraft/server/PlayerList.java | 6 +++++-
 src/main/java/org/bukkit/craftbukkit/Spigot.java   | 2 ++
 src/main/resources/configurations/bukkit.yml       | 1 +
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/PlayerList.java b/src/main/java/net/minecraft/server/PlayerList.java
index d13fa19..aaf447a 100644
--- a/src/main/java/net/minecraft/server/PlayerList.java
+++ b/src/main/java/net/minecraft/server/PlayerList.java
@@ -651,9 +651,13 @@ public abstract class PlayerList {
     }
 
     public void tick() {
-        if (++this.o > 600) {
+        // Spigot start
+        if (++this.o > 600 && org.bukkit.craftbukkit.Spigot.tabPing) {
             this.o = 0;
+            EntityPlayer entityplayer = (EntityPlayer) this.players.get(this.o);
+            this.sendAll(new Packet201PlayerInfo(entityplayer.name, true, entityplayer.ping));
         }
+        // Spigot end
 
         /* CraftBukkit start - remove updating of lag to players -- it spams way to much on big servers.
         if (this.o < this.players.size()) {
diff --git a/src/main/java/org/bukkit/craftbukkit/Spigot.java b/src/main/java/org/bukkit/craftbukkit/Spigot.java
index 04f8f56..709a4f0 100644
--- a/src/main/java/org/bukkit/craftbukkit/Spigot.java
+++ b/src/main/java/org/bukkit/craftbukkit/Spigot.java
@@ -6,6 +6,7 @@ import org.bukkit.configuration.file.YamlConfiguration;
 import java.util.List;
 
 public class Spigot {
+    public static boolean tabPing = false;
     public static void initialize(CraftServer server, SimpleCommandMap commandMap, YamlConfiguration configuration) {
         commandMap.register("bukkit", new org.bukkit.craftbukkit.command.RestartCommand("restart"));
         commandMap.register("bukkit", new org.bukkit.craftbukkit.command.TicksPerSecondCommand("tps"));
@@ -40,6 +41,7 @@ public class Spigot {
             server.chunkGCPeriod = 600;
         }
 
+        tabPing = configuration.getBoolean("settings.tab-ping", tabPing);
     }
 
     /**
diff --git a/src/main/resources/configurations/bukkit.yml b/src/main/resources/configurations/bukkit.yml
index 5933a88..8ddda07 100644
--- a/src/main/resources/configurations/bukkit.yml
+++ b/src/main/resources/configurations/bukkit.yml
@@ -35,6 +35,7 @@ settings:
     spam-exclusions:
        - /skill
     map-send-interval: 10000
+    tab-ping: false
 world-settings:
     default:
         growth-chunks-per-tick: 650
-- 
1.8.1-rc2

